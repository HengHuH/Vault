游戏中常用的空间数据结构

一般用于加速空间相关查询

- 加速可见性判定视锥剪裁
- 加速射线检测
- 近邻查询
- 碰撞检测的粗测阶段

Grid 网格划分

棋盘
正方形，正六边形
常用于平面
BSP（二叉空间分割树）
Binary Space Partitioning Tree
一棵二叉树，每个节点表示一条边（三维下表示一个平面），将当前空间划分为前向和背向两个子空间。

![[game-structures-1.jpeg]]

构建

- 要相对平衡，每次划分左子树和右子树的节点数量差要小于一个阈值
- 解决两个平面相交问题，切分
- 时间复杂度，O(n*lgn*lgn)
- 判断点在平面前后：平面法向量（A，B，C），平面方程：Ax+By+Cz+D=0，点(x0,y0,z0）带入，distance=Ax0+By0+Cz0+D，distance < 0 平面背后，=0 在平面上

应用

- 自动生成室内 portal 系统
- 辅助生成导航网格（NavMesh）
- 空间管理（对特殊游戏玩法，门、墙 KickDoor）
- 渲染顺序优化（已过时）

QuadTree，OcTree

将空间递归划分为不同层次的树结构

![[game-structures-2.jpeg]]

![[game-structures-3.jpeg]]

边界问题，物体可能在边界处左右横跳，频繁切换节点，触发频发更新树。可使用松散的四叉树、八叉树解决。

应用

- 场景管理，适合大规模广阔室外场景管理（球球大作战）

BVH，层次包围盒树
Bounding Volume Hierarchy Based On Tree
多叉树
AABB 包围盒

![[game-structures-4.jpeg]]

球体包围盒

应用

- 碰撞检测优化（粗测阶段）
- 射线检测
- 视锥剔除
- 辅助 BSP 构建，光线追踪过滤等

k-dimensional Tree（k-d 树）

k-d 树是一棵二叉树，常用于高位空间中的搜索。

- 每个节点代表一个 k 维坐标点
- 树的每层都是对应一个划分维度
- 每个节点代表一个超平面（n 维欧式空间中余维度等一的线性子空间，维度为 n-1），该超平面垂直于当前划分维度的坐标轴，并在该维度上将空间划分为两部分
- 一种特殊形式的 BSP，轴对齐
  ![[game-structures-5.jpeg]]
  ![[game-structures-6.jpeg]]
  构建

- 初始化分割轴，计算每个维度数据的方差，取最大方差作为分割轴 r
- 确定节点，找到中位数数据
- 划分双支，在当前分割轴维度，将数据根据中位数节点划分到左右分支中
- 更新分割轴 r = (r + 1) % k
- 确定子节点，对左右节点中数据递归进行【确定节点】

应用

- 最近邻查找（S1，足球轨迹动画）
- 划分区域，因为构建耗时，不支持动态构建（变化后全部重新构建），不实用

自定义区域划分
一个自定义区域一般是一个凸多边形，使用树或图描述它们之间的关系
判断点是否在凸多边形内
![[game-structures-7.jpeg]]
应用

- 更灵活的分区块渲染
  ![[game-structures-8.jpeg]]]
- 地图载入
  ![[game-structures-9.jpeg]]
